# 调试记录
#### 2021-5-29

> **PID参数：**
>
> * 互补滤波器参数 [0.999]  
> * ax -p 250000 -i 0 -d 30000 -s 3.8  
> * sx -p 0 -i 0

**主要调整**

1. **互补滤波器参数由 0.9->0.95->0.99**。在0.99处大幅减轻了系统震动，经分析互补滤波的作用是在**短时（实时）使用陀螺仪的积分数值作为角度，长时使得滤波后的值收敛至加速度计角度值**，而由于加速度计对震动噪声极为敏感（这是传感器的特性无法消除，在强震动下加速度计数据不滤波的话基本无法使用），所以应该适当加大陀螺仪的权重，最终效果是滤波后抖动明显减弱。

2. **飞轮固定件重新设计打印，使得飞轮相对于旋转轴尽量中心对称**。同样也是为了减轻震动。

目前已经可以初步稳定（但持续不了多久），调试过程发现用手按住控制板减轻震动后可以有效提升稳定性，因此之前**用橡胶球连接板子的方式是不合理的**，后续尝试强化控制板和部件的连接刚度减小震动。

可见不同于以往的小车调试，在大车的功率和惯量下系统震动影响被大幅度放大，传感器数据必须经过妥善滤波处理才能使系统稳定，这点在后续改进。

PID参数调试思路大概是先调P导致左右晃动，~~再单独调D（此时很不稳定会导致高频振荡），加上PD（D的值由0逐渐加，大概就在单独D的震荡点附近，再酌情增大，此时反而不会震荡）。~~

---

#### 2021-5-30

> **PID参数：**
>
> * 互补滤波器参数 [0.999]  
> * ax -p 500000 -i 0 -d 8000000 -s 2.4
> * sx -p 0.000003  -i 0.0000001
>
> **2阶ButterWorth滤波器参数：**
>
> * GYRO_LPF_CUTOFF_FREQ    150
> *  ACCEL_LPF_CUTOFF_FREQ    150

**主要调整**

1. 角度换P用互补滤波，D用2nd BW滤波，可以勉强稳定


---

#### 2021-5-31

> **PID参数：**
>
> * 互补滤波器参数 [0.999]  
> * ax -p 1500000 -i 0 -d 80000000 -s 1
> * sx -p 0.000002  -i 0.00000003 
>
> **2阶ButterWorth滤波器参数：**
>
> * GYRO_LPF_CUTOFF_FREQ    100
> *  ACCEL_LPF_CUTOFF_FREQ    50
>
> **Ctrl-FOC驱动器参数：**
>
> * vel_gain = 0.0003 
> * vel_integrator_gain = 0.006 

**主要调整**

修改FOC参数





MPU6050低通滤波寄存器中 setDLPFMode(MPU6050_DLPF_BW_98)的作用待检验。

PID output滑动滤波参数N=1待验证（是否可以去掉，加大效果是否更好？）

Ctrl加电流，增加恢复力